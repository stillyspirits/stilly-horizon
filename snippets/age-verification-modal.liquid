{% comment %}
  Age Verification Modal
  - Shows a modal dialog requiring users to verify their age
  - Uses the native dialog component from stilly-horizon
  - Stores verification in a cookie to remember users
{% endcomment %}

<age-verification-modal class="age-verification-modal" data-minimum-age="{{ settings.age_verification_minimum_age }}" data-cookie-days="{{ settings.age_verification_cookie_days }}">
  <dialog ref="dialog" class="age-verification-dialog">
    <div class="age-verification-content">
      {% if settings.age_verification_logo %}
        <div class="age-verification-logo">
          {{
            settings.age_verification_logo
            | image_url: width: settings.age_verification_logo_width
            | image_tag:
              loading: 'lazy',
              alt: shop.name,
              widths: '50, 100, 150, 200, 250, 300',
              sizes: '(max-width: 768px) 100px, {{ settings.age_verification_logo_width }}px'
          }}
        </div>
      {% endif %}

      <div class="age-verification-form-wrapper" ref="formWrapper">
        <h2 class="age-verification-title">{{ settings.age_verification_title }}</h2>
        {% if settings.age_verification_subtitle != blank %}
          <p class="age-verification-subtitle">{{ settings.age_verification_subtitle }}</p>
        {% endif %}

        <form class="age-verification-form" ref="form">
          <div class="age-input-group">
            <input
              type="number"
              name="month"
              ref="monthInput"
              class="age-input"
              placeholder="MM"
              min="1"
              max="12"
              required
              pattern="[0-9]*"
              inputmode="numeric"
              autocomplete="off"
              aria-label="Month"
            >
            <input
              type="number"
              name="day"
              ref="dayInput"
              class="age-input"
              placeholder="DD"
              min="1"
              max="31"
              required
              pattern="[0-9]*"
              inputmode="numeric"
              autocomplete="off"
              aria-label="Day"
            >
            <input
              type="number"
              name="year"
              ref="yearInput"
              class="age-input"
              placeholder="YYYY"
              min="1900"
              max="{{ 'now' | date: '%Y' }}"
              required
              pattern="[0-9]*"
              inputmode="numeric"
              autocomplete="off"
              aria-label="Year"
            >
          </div>

          <button type="submit" class="age-verification-submit button button--primary" disabled ref="submitButton">
            {{ settings.age_verification_button_text }}
          </button>
        </form>

        {% if settings.age_verification_footer_text != blank %}
          <div class="age-verification-footer">
            {{ settings.age_verification_footer_text }}
          </div>
        {% endif %}

        {% if settings.age_verification_disclaimer != blank %}
          <div class="age-verification-disclaimer">
            {{ settings.age_verification_disclaimer }}
          </div>
        {% endif %}

        {% if settings.age_verification_show_terms %}
          <div class="age-verification-terms">
            <p>
              By submitting this form, you agree to be bound by the
              <a href="/policies/terms-of-service">Terms of Service</a> and
              <a href="/policies/privacy-policy">Privacy Policy</a>.
            </p>
          </div>
        {% endif %}
      </div>

      <div class="age-verification-error hidden" ref="errorWrapper">
        <h2 class="age-verification-error-title">{{ settings.age_verification_error_title }}</h2>
        
        <div class="countdown-timer">
          <div class="countdown-item">
            <span class="countdown-value" ref="days">0</span>
            <span class="countdown-label">days</span>
          </div>
          <div class="countdown-item">
            <span class="countdown-value" ref="hours">0</span>
            <span class="countdown-label">hours</span>
          </div>
          <div class="countdown-item">
            <span class="countdown-value" ref="minutes">0</span>
            <span class="countdown-label">minutes</span>
          </div>
          <div class="countdown-item">
            <span class="countdown-value" ref="seconds">0</span>
            <span class="countdown-label">seconds</span>
          </div>
        </div>

        <p class="age-verification-error-subtitle">{{ settings.age_verification_error_subtitle }}</p>

        <button type="button" class="age-verification-retry button button--secondary" ref="retryButton">
          {{ settings.age_verification_retry_text }}
        </button>
      </div>
    </div>
  </dialog>
</age-verification-modal>

<script src="{{ 'age-verification-modal.js' | asset_url }}" type="module" defer></script>
<link rel="stylesheet" href="{{ 'age-verification.css' | asset_url }}" media="all">