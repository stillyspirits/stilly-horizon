{%- doc -%}
  Renders an image block.

  @param {string} [loading] - The html loading attribute
  @param {string} [placeholder] - The placeholder image name to use when no image is provided, defaults to 'hero-apparel-2'
{%- enddoc -%}

{% assign block_settings = block.settings %}
{% assign image = closest.collection.featured_image | default: closest.product.featured_image %}
{% assign alt = closest.collection.title | default: closest.product.title %}

{% liquid
  assign width = '100%'
  assign media_width_desktop = '100vw'
  assign media_width_mobile = '100vw'
  assign sizes = 'auto, (min-width: 750px) ' | append: media_width_desktop | append: ', ' | append: media_width_mobile
  assign widths = '240, 352, 832, 1200, 1600, 1920, 2560'
%}

{% if image %}
  <image-block
    ratio="{{ block_settings.ratio }}"
    height="{{ block_settings.height }}"
    style="--border-radius: {{ block_settings.border_radius }}px; --image-fit: {{ block_settings.image_fit | default: 'cover' }}; --image-position: {{ block_settings.image_position | default: 'center center' }};"
    {{ block.shopify_attributes }}
  >
    {{
      image
      | image_url: width: 2560
      | image_tag: width: width, widths: widths, sizes: sizes, loading: loading, alt: alt
    }}
  </image-block>
{% else %}
  <image-block
    ratio="{{ block_settings.ratio }}"
    height="{{ block_settings.height }}"
    style="--border-radius: {{ block_settings.border_radius }}px; --image-fit: {{ block_settings.image_fit | default: 'cover' }}; --image-position: {{ block_settings.image_position | default: 'center center' }};"
    {{ block.shopify_attributes }}
  >
    {{ placeholder | default: 'hero-apparel-2' | placeholder_svg_tag: 'hero__image' }}
  </image-block>
{% endif %}

{% stylesheet %}
  image-block {
    --image-height-basis: 10rem;
    --image-height-small: calc(var(--image-height-basis) * 2);
    --image-height-medium: calc(var(--image-height-basis) * 3);
    --image-height-large: calc(var(--image-height-basis) * 4);

    display: flex;
    align-items: center;
    justify-content: center;
    aspect-ratio: var(--ratio);
    width: 100%;
    max-width: calc(var(--image-height) * var(--ratio));
    height: var(--image-height);
    overflow: hidden;

    @media screen and (min-width: 750px) {
      --image-height-small: calc(var(--image-height-basis) * 2.5);
      --image-height-medium: calc(var(--image-height-basis) * 3.5);
      --image-height-large: calc(var(--image-height-basis) * 4.5);
    }

    @media screen and (max-width: 749px) {
      height: auto;
    }

    &[height='small'] {
      --image-height: var(--image-height-small);
    }

    &[height='medium'] {
      --image-height: var(--image-height-medium);
    }

    &[height='large'] {
      --image-height: var(--image-height-large);
    }

    &[ratio='portrait'] {
      --ratio: 4 / 5;
    }

    &[ratio='square'] {
      --ratio: 1 / 1;

      @media screen and (min-width: 750px) {
        max-width: var(--image-height);
      }
    }

    &[ratio='landscape'] {
      --ratio: 16 / 9;
    }

    img {
      object-fit: var(--image-fit, cover);
      object-position: var(--image-position, center center);
      width: 100%;
      height: auto;
      aspect-ratio: var(--ratio);
      border-radius: var(--border-radius);
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:names.image",
  "tag": null,
  "settings": [
    {
      "type": "paragraph",
      "content": "t:content.resource_reference_collection_card_image"
    },
    {
      "type": "select",
      "id": "height",
      "label": "t:settings.height",
      "options": [
        {
          "value": "small",
          "label": "t:options.small"
        },
        {
          "value": "medium",
          "label": "t:options.medium"
        },
        {
          "value": "large",
          "label": "t:options.large"
        }
      ],
      "default": "large"
    },
    {
      "type": "select",
      "id": "ratio",
      "label": "t:settings.ratio",
      "options": [
        {
          "value": "portrait",
          "label": "t:options.portrait"
        },
        {
          "value": "square",
          "label": "t:options.square"
        },
        {
          "value": "landscape",
          "label": "t:options.landscape"
        }
      ],
      "default": "portrait"
    },
    {
      "type": "range",
      "id": "border_radius",
      "label": "t:settings.border_radius",
      "min": 0,
      "max": 32,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "header",
      "content": "Image Alignment"
    },
    {
      "type": "select",
      "id": "image_fit",
      "label": "Image fit",
      "info": "How the image should fit within its container",
      "options": [
        {
          "value": "contain",
          "label": "Contain (show entire image)"
        },
        {
          "value": "cover",
          "label": "Cover (fill container)"
        },
        {
          "value": "fill",
          "label": "Fill (stretch to fit)"
        },
        {
          "value": "none",
          "label": "None (original size)"
        },
        {
          "value": "scale-down",
          "label": "Scale down"
        }
      ],
      "default": "cover"
    },
    {
      "type": "select",
      "id": "image_position",
      "label": "Image position",
      "info": "Where to position the image within its container",
      "options": [
        {
          "value": "left top",
          "label": "Top left"
        },
        {
          "value": "center top",
          "label": "Top center"
        },
        {
          "value": "right top",
          "label": "Top right"
        },
        {
          "value": "left center",
          "label": "Center left"
        },
        {
          "value": "center center",
          "label": "Center"
        },
        {
          "value": "right center",
          "label": "Center right"
        },
        {
          "value": "left bottom",
          "label": "Bottom left"
        },
        {
          "value": "center bottom",
          "label": "Bottom center"
        },
        {
          "value": "right bottom",
          "label": "Bottom right"
        }
      ],
      "default": "center center"
    }
  ]
}
{% endschema %}
